---
title: "TestPredictionQuality"
author: "Thomas Mey"
date: "13. April 2016"
output: html_document
---


## setup environment
```{r}

directory<-paste0(".\\data\\test\\en_US")
nGramDirectory<-paste0(".\\data\\small\\NGrams")
if(!file.exists(nGramDirectory)) {
     dir.create(nGramDirectory)
}
```

## read profanity
```{r }
con <- file(".\\data\\profanity_en.txt", "r") 
p<-readLines(con) 
close(con)
``` 



```{r}
options(mc.cores=1)

source("Common.r")

n1GramTable<-read.csv(paste0(nGramDirectory,"\\N1Grams.csv"))
n2GramTable<-read.csv(paste0(nGramDirectory,"\\N2Grams.csv"))
n3GramTable<-read.csv(paste0(nGramDirectory,"\\N3Grams.csv"))

#build and cleanse test corpus
library(tm)   
docs <- Corpus(DirSource(directory))
docs<-preprocess(docs,p)

docs[[3]]$content[500]
length(docs[[1]]$content)
length(docs[[2]]$content)
length(docs[[3]]$content)

corpus_df <- data.frame(text=lapply(docs[1], '[',"content"), stringsAsFactors=F)
corpus_df <- rbind(corpus_df,data.frame(text=lapply(docs[2], '[',"content"), stringsAsFactors=F))
corpus_df <- rbind(corpus_df,data.frame(text=lapply(docs[3], '[',"content"), stringsAsFactors=F))

corpus_df<-corpus_df$content
corpus_df[19]

#build sample stings
numberOfStingsToSample<-10

n<-sample(length(corpus_df),numberOfStingsToSample)
testset<-corpus_df[n]

#build test string and match
tt<-{}
for(i in 1:numberOfStingsToSample) {
  t<-testset[i]
  s<-gregexpr(" ",t)
  t1<-t(data.frame(lapply(s[[1]], function(x) {
    x<-substr(t,0,x-1)
    g <- regexpr("\\ [^\\ ]*$", x)
    c(substring(x,0,g-1),trimws(substring(x,g)))
  })))
  
  colnames(t1)<-c("test","match")
  rownames(t1)<-NULL
  tt<-rbind(tt,t1)
}

head(tt)

#test...

r<-NULL
for(i in 1:dim(tt)[1]) {
  res<-predictWord(as.character(tt[i,1]),5)$word
  print(paste("Match:", tt[i,2]))
  print(res)
  r1<-tt[i,2]  %in% res
  print(r1)
  r<-c(r,r1)
}


table(r==TRUE)

```


